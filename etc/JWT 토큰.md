# JWT(JSON WEB TOKEN) 토큰
JWT는 유저를 인증하고 식별하기 위한 토큰(Token) 기반 인증이다. 토큰은 세션과는 달리 서버가 아닌 클라이언트에 저장되기 때문에
메모리나 스토리지 등을 통해 세션을 관리했던 서버의 부담을 덜 수 있다.

JWT가 가지는 핵심적인 특징은 **토큰 자체에 사용자의 권한 정보나 서비스를 사용하기 위한 정보가 포함(Self-contained)** 된다는 것이다.
데이터가 많아지면 토큰이 커질 수 있으며 토큰이 한번 발급된 이후 사용자의 정보를 바꾸더라도 토큰을 재발급하지 않으면 반영되지 않는다.

JWT를 사용하면 RESTful과 같은 무상태(Stateless)인 환경에서 사용자 데이터를 주고 받을 수 있게된다.
세션(Session)을 사용하게 될 경우에는 쿠키 등을 통해 식별하고 서버에 세션을 저장했지만 JWT와 같은 토큰을 클라이언트에 저장하고
요청시 단순히 HTTP 헤더에 토큰을 첨부하는 것만으로도 단순하게 데이터를 요청하고 응답을 받아올 수 있다.

# JWT 인증 순서
1. 아이디, 패스워드를 통해 웹서비스 인증
2. 서버에서 서명된(Signed) JWT를 생성하여 클라이언트에 응답
3. 클라이언트가 서버에 데이터를 추가적으로 요구할 때 JWT를 HTTP Header에 첨부
4. 서버에서 클라이언트로부터 전달받은 JWT를 검증

# JWT 구조
JWT는 Header, Payload, Signature로 구성된다. 또한 각 요소는 .으로 구분된다.

![jwt](https://user-images.githubusercontent.com/55070039/173524739-a5e4c049-4565-485f-a63d-6d7a5fb5ae80.png)

- Header: JWT에서 사용할 타입과 해시 알고리즘의 종류가 담겨있다.
- Payload: 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨있다.
- Signature: Header, Payload를 **Base64 URL-safe Encode**를 한 이후 Header에 명시된 해시함수를 적용하고, 개인키(Private Key)로 서명한 전자서명이 담겨 있다. 

# JWT 장점
- 토큰 자체가 인증된 정보이기 때문에 세션 저장소와 같은 별도의 인증 저장소가 필수적으로 필요하지 않다.
- 세션과는 다르게 클라이언트의 상태를 서버가 저장해 두지 않아도 된다.
- signature 암호화를 통해 데이터의 보안성이 늘어남
- 다른 서비스에 이용할 수 있는 공통적인 스펙으로써 사용할 수 있다.

# JWT 단점
- base64 인코딩을 통한 정보를 전달하므로 전달량이 많다. 따라서 네트워크 트래픽이 증가할 수 있다.
- Payload에는 암호화가 되어있지 않기 때문에 민감 정보를 저장할 수 없다.
- 토큰이 탈취당하면 만료될 때까지 대처가 불가능하다.

# JWT 단점 보안
JWT 토큰은 탈취 시 대처가 불가능 하다는 단점이 있다. 그로인해 `Expiration Time(만료시간)`을 짧게 가져가는데
이로 인해 사용자는 30분~1시간 간격으로 재로그인 해야하는 불편함 또한 생겨난다.

## Sliding Session
짧은 만료시간을 보완하기 위해 특정 유저에 대해 만료시간을 연장 시켜주는 방법이다. Sliding Session을 사용하게 되면
글쓰기, 결제등과 같은 특정 action 시에 만료시간을 늘린 JWT를 재발행하여 만료시간을 연장하여 보완한다.

다만, 접속이 단발성으로 일어나면 만료시간을 연장시켜줄 수 없고 너무 긴 Access Token을 발급한 상황이라면 Sliding Session으로 인해
토큰을 무한정 사용하는 상황이 발생될 수 있다.

## Refresh Token
가장 많이 사용되는 방법으로 JWT를 처음 발급할 때 Access Token과 함께 Refresh Token도 발행하여 짧은 만료시간을 해결하는 방법이다.
비교적 긴 시간(7일, 30일)의 만료시간을 가진 Refresh Token은 이름 그대로 Access Token을 Refesh 해주는 것을 보장하는 토큰이다.

만약 클라이언트가 Access Token이 만료됨을 인지하거나, 서버로부터 만료됨을 확인 받았다면 Refresh Token을 통해 서버에 새로운 Access Token을 발급하도록
요청하여 발급받는 방식이다.

1. 클라이언트가 ID, PW로 서버에 인증을 요청하고, 서버는 이를 확인하여 Access Token과 Refresh Token을 발급
2. 클라이언트는 발급받은 두 토큰을 저장하고 서버요청 시에 Access Token을 활용
3. 요청 도중 Access Token이 만료되어 서버로부터 오류를 전달받음
4. 클라이언트는 저장하고 있던 Refresh Token을 서버로 전달하여 새로운 Access Token 발급 요청
5. 서버는 Refresh Token Storage에 해당 토큰이 있는지 확인하고, 있을 경우 Access Token을 생성하여 전달
